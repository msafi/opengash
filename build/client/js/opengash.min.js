"use strict";angular.module("ogServices",[]).factory("authUrl",["$http","$q",function(a,b){var c=b.defer();return a({method:"GET",url:"api/authurl/json"}).then(function(a){c.resolve(a.data.url)}),c.promise}]).factory("gaApi",["$http","$cookies","$q","$timeout",function(a,b,c,d){var e,f={};return f.call=function(c,d){var e={access_token:b.accessToken};a({method:"GET",url:c,params:e}).success(function(a){d(a)})},f.fetchViews=function(a){var b="https://www.googleapis.com/analytics/v3/management/accounts/~all/webproperties/~all/profiles";f.call(b,function(b){for(var c=[],d=0;d<b.items.length;d++)c.push({name:b.items[d].name,id:b.items[d].id});a(c)})},e=0,f.getReport=function(f,g,h,i){var j=300,k={access_token:b.accessToken,ids:f,"start-date":g,"end-date":h,metrics:i},l=c.defer();return d(function(){a({method:"GET",url:"https://www.googleapis.com/analytics/v3/data/ga",params:k}).success(function(a){l.resolve(a)})},e),e+=j,l.promise},f}]).factory("ogAccount",["$http","$cookies","gaApi","$q",function(a,b,c,d){var e={csrf:b.csrf},f={};return f.getSavedViews=function(){var b=d.defer();return a({method:"GET",url:"api/ga-views/json",params:e}).success(function(a){a?b.resolve(a):b.reject()}),b.promise},f.getAllViews=function(){var a=d.defer();return c.fetchViews(function(b){a.resolve(b)}),a.promise},f.saveViews=function(b){a({method:"POST",url:"api/ga-views/json",params:e,data:b})},f}]).factory("periods",["dateFilter",function(a){var b={},c=function(b){var c;return c=(new Date).getTime(),a(c-864e5*b,"yyyy-MM-dd")};return b.dates={today:{start:c(0),end:c(0)},yesterday:{start:c(1),end:c(1)},week:{start:c(7),end:c(1)},month:{start:c(30),end:c(1)},year:{start:c(365),end:c(1)}},b.comparisonDates={yesterday:{start:c(8),end:c(8)},week:{start:c(14),end:c(8)},month:{start:c(60),end:c(31)},year:{start:c(730),end:c(366)}},b.ordered=["Today","Yesterday","Week","Month","Year"],b.totalPeriods=function(){return Object.keys(b.dates).length+Object.keys(b.comparisonDates).length}(),b.forEach=function(a,c){var d;a.forEach(function(a){for(d in b.dates)c(a,d)})},b}]),angular.module("ogControllers",[]).controller("mainCtrl",["$state","$cookies","ogAccount",function(a,b,c){void 0!==b.loggedIn&&void 0!==b.accessToken?c.getSavedViews().then(function(){a.go("dashboard")},function(){a.go("addViews")}):a.go("login")}]).controller("connectCtrl",["$scope","authUrl",function(a,b){a.authUrl=b}]).controller("addViewsCtrl",["$scope","ogAccount","$state",function(a,b,c){a.allViews=b.getAllViews(),a.selectedViews=[],a.updateSelection=function(b,c){b.target.checked&&-1===a.selectedViews.indexOf(c)&&a.selectedViews.push(c),b.target.checked||-1===a.selectedViews.indexOf(c)||a.selectedViews.splice(a.selectedViews.indexOf(c),1)},a.saveSelectedViews=function(){b.saveViews(a.selectedViews),c.go("dashboard")}}]).controller("dashboardCtrl",["$scope","gaApi","ogAccount","periods","metricsData",function(a,b,c,d,e){c.getSavedViews().then(function(c){var f=c.map(function(a){return"ga:"+a.id});a.tableStructure={metrics:e.raw,views:f,periods:d.ordered},a.tableContent={},a.tableComparisonContent={},a.metricPrettyNameFinder=e.names,d.forEach(f,function(c,f){var g=d.dates[f].start,h=d.dates[f].end,i="today"!=f;b.getReport(c,g,h,""+e.raw).then(function(b){void 0===a.tableContent[b.profileInfo.tableId]&&(a.tableContent[b.profileInfo.tableId]={}),a.tableContent[b.profileInfo.tableId][f]=b}),i&&(g=d.comparisonDates[f].start,h=d.comparisonDates[f].end,b.getReport(c,g,h,""+e.raw).then(function(b){void 0===a.tableComparisonContent[b.profileInfo.tableId]&&(a.tableComparisonContent[b.profileInfo.tableId]={}),a.tableComparisonContent[b.profileInfo.tableId][f]=b}))})})}]),angular.module("ogDirectives",[]).directive("movement",["metricsData","$sce",function(a,b){return{scope:{current:"@",comparison:"@",metric:"@"},restrict:"E",template:'<p class="movement" ng-bind-html="movement"></p>',link:function(c){c.$watchCollection("[current, comparison]",function(){var d;c.movement="",parseFloat(c.current)&&parseFloat(c.comparison)&&(d=100*((c.current-c.comparison)/c.current),d=parseFloat(d.toFixed(1)),d=d>0?a.biggerIsBetter[c.metric]&&0!=d?"<span class='text-success'>"+d+"%</span>":"<span class='text-danger'>"+d+"%</span>":a.biggerIsBetter[c.metric]||0==d?"<span class='text-danger'>"+d+"%</span>":"<span class='text-success'>"+d+"%</span>",c.movement=b.trustAsHtml(d))})}}}]),angular.module("ogMetricsData",[]).factory("metricsData",[function(){var a={};return a.names={"ga:visitors":"Unique visitors","ga:pageviews":"Pageviews","ga:pageviewsPerVisit":"Pages per visit","ga:avgTimeOnSite":"Average time on site","ga:visitBounceRate":"Bounce rate","ga:percentNewVisits":"Percentage of new visits","ga:avgPageLoadTime":"Average page load time"},a.biggerIsBetter={"ga:visitors":!0,"ga:pageviews":!0,"ga:pageviewsPerVisit":!0,"ga:avgTimeOnSite":!0,"ga:visitBounceRate":!1,"ga:percentNewVisits":!0,"ga:avgPageLoadTime":!1},a.type={"ga:visitors":"integer","ga:pageviews":"integer","ga:pageviewsPerVisit":"integer","ga:avgTimeOnSite":"seconds","ga:visitBounceRate":"percentage","ga:percentNewVisits":"percentage","ga:avgPageLoadTime":"seconds"},a.raw=function(){var b=[];for(var c in a.names)b.push(c);return b}(),a.pretty=function(){var b=[];for(var c in a.names)b.push(a.names[c]);return b}(),a}]).filter("metrics",["metricsData","numberFilter",function(a,b){return function(c,d){if(!c)return"";switch(a.type[d]){case"integer":return b(parseFloat(parseFloat(c).toFixed(2)));case"seconds":var e=parseInt(c,10),f=Math.floor(e/3600),g=Math.floor((e-3600*f)/60),h=e-3600*f-60*g;10>f&&(f="0"+f),10>g&&(g="0"+g),10>h&&(h="0"+h);var i=f+":"+g+":"+h;return i;case"percentage":return parseFloat(parseFloat(c).toFixed(1))+"%";default:return c}}}]),angular.module("opengash",["ngCookies","ui.router","ogControllers","ogServices","ogDirectives","ogMetricsData"]).config(["$stateProvider","$locationProvider",function(a,b){a.state("login",{templateUrl:"connect.html"}).state("addViews",{templateUrl:"add-views.html"}).state("dashboard",{templateUrl:"dashboard.html"}),b.html5Mode(!0).hashPrefix("!")}]);
//# sourceMappingURL=http://opengash.com/js/opengash.min.js.map