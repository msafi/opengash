<!DOCTYPE html>


<html lang="en">
<head>
	<meta charset="utf-8">
	<title>og docs Source: server/ogGaApi.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	
	<link type="text/css" rel="stylesheet" href="styles/site.cerulean.css">
	

</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top navbar-inverse">
		<div class="navbar-inner">
			<a class="brand" href="index.html">og docs</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="" class="dropdown-toggle" data-toggle="dropdown">Config &amp; bootstrap<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href='/docs/server.html'>server.js (app entry point)</a>
						</li>
						
						<li>
							<a href='/docs/server.config.html'>Server side configurations</a>
						</li>
						
						<li>
							<a href='/docs/url.index.html'>Index of handled URLs</a>
						</li>
						
						<li>
							<a href='/docs/request.handlers.html'>URL handlers</a>
						</li>
						
						<li>
							<a href='/docs/ng.opengash.html'>AngularJS bootstrap</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="" class="dropdown-toggle" data-toggle="dropdown">Node.js modules<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href='/docs/ogGaApi.html'>ogGaApi</a>
						</li>
						
						<li>
							<a href='/docs/ogAccount.html'>ogAccount</a>
						</li>
						
						<li>
							<a href='/docs/ogUtil.html'>ogUtil</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="" class="dropdown-toggle" data-toggle="dropdown">AngularJS services<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href='/docs/ng.service.periods.html'>periods</a>
						</li>
						
						<li>
							<a href='/docs/ng.service.ogAccount.html'>ogAccount</a>
						</li>
						
						<li>
							<a href='/docs/ng.service.gaApi.html'>gaApi</a>
						</li>
						
						<li>
							<a href='/docs/ng.service.authUrl.html'>authUrl</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="" class="dropdown-toggle" data-toggle="dropdown">AngularJS controllers<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href='/docs/ng.controller.addViewsCtrl.html'>addViewsCtrl</a>
						</li>
						
						<li>
							<a href='/docs/ng.controller.connectCtrl.html'>connectCtrl</a>
						</li>
						
						<li>
							<a href='/docs/ng.controller.dashboardCtrl.html'>dashboardCtrl</a>
						</li>
						
						<li>
							<a href='/docs/ng.controller.mainCtrl.html'>mainCtrl</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
			<div class="span12">
				
				<div id="main">
					


		<h1 class="page-title">Source: server/ogGaApi.js</h1>
    
    <section>
        <article>
            <pre class="sunlight-highlight-javascript ">/**
 * A module to interact with Google Analytics API.
 *
 * You give this module your Google client ID, client secret,
 * and redirect URL, and it'll do things with Google Analytics API
 * and Google OAuth 2.0 login.
 *
 * @namespace ogGaApi
 */
// Todo: Validate ID Tokens using Google's public certificates

var request = require('request');
var qs = require('querystring');



/**
 * Instantiate an object with the following parameters. These parameters are configured in {@link server.config}
 *
 * @param clientId {string} Google API client ID
 * @param clientSecret {string} Google API client secret
 * @param redirectUrl {string} The redirect URL as in your Google API console settings. Should be absolute URL.
 *
 * @function ogGaApi#OgGaApi
 * @returns {object}
 */
function OgGaApi(clientId, clientSecret, redirectUrl) {
  this.clientId = clientId;
  this.clientSecret = clientSecret;
  this.redirectUrl = redirectUrl;

  return this;
}



/**
 * Returns a string that a user could follow to authenticate with Google OAuth 2.0.
 *
 * @param [csrf] {string} An optional anti cross site request forgery token. In opengash, such token can
 * be generated by {@link ogUtil.csrf}
 *
 * @function ogGaApi#url
 * @returns {string} A Google OAuth 2.0 compatible URL
 */
OgGaApi.prototype.url = function (csrf) {
  var params = {
    client_id: this.clientId,
    response_type: "code",
    scope: "email https://www.googleapis.com/auth/analytics.readonly https://www.googleapis.com/auth/userinfo.profile",
    redirect_uri: this.redirectUrl
  }
  if (csrf) params.state = "csrf=" + csrf;
  if (process.env.NODE_ENV !== 'production') params.prompt = 'consent';

  return "https://accounts.google.com/o/oauth2/auth?" + qs.stringify(params);
}



/**
 * Uses the supplied `code` parameter to POST an access token request to Google
 *
 * @param code {string} the code which will be returned as a GET parameter to the redirect
 * URL specified in your {@link server.config}
 *
 * @param callback {function} A callback function that is given:
 *
 * * `err`: is a JavaScript error object
 * * `res`: is a Node.js response object
 * * `body`: JSON string that needs to be parsed
 *
 * @function ogGaApi#requestAccessToken
 *
 * @todo Maybe use a Promise instead of a callback?
 */
OgGaApi.prototype.requestAccessToken = function (code, callback) {
  var params = {
    code: code,
    client_id: this.clientId,
    client_secret: this.clientSecret,
    redirect_uri: this.redirectUrl,
    grant_type: 'authorization_code'
  }
  var url = "https://accounts.google.com/o/oauth2/token";

  request.post({url: url, form: params}, function (err, res, body) {
    callback(err, res, body);
  });
}



/**
 * This is a general-purpose method that makes it easy to communicate with Google API.
 *
 * @param accessToken {string} The access token obtained from {@link ogGaApi#requestAccessToken}
 * @param apiUrl {string} The API end-point that you want to query.
 * @param callback {string} A callback to do something with the results. The parameters passed
 * to the callback are:
 *
 * * `err`: JavaScript error object
 * * `res`: Node.js response object
 * * `body`: JSON string that needs to be parsed.
 *
 * @function ogGaApi#call
 *
 * @todo: Use a Promise instead of a callback?
 */
OgGaApi.prototype.call = function (accessToken, apiUrl, callback) {
  var qs = {access_token: accessToken};
  request.get({url: apiUrl, qs: qs}, function (err, res, body) {
    callback(err, res, body);
  });
}

module.exports = OgGaApi;</pre>
        </article>
    </section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0-dev</a>
		on Sun Sep 08 2013 19:10:59 GMT+0300 (AST) using the <a href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<br clear="both">
		</div>

	</div>
	<script src="scripts/sunlight.js"></script>
	<script src="scripts/sunlight.javascript.js"></script>
	<script src="scripts/sunlight-plugin.doclinks.js"></script>
	<script src="scripts/sunlight-plugin.linenumbers.js"></script>
	<script src="scripts/sunlight-plugin.menu.js"></script>
	<script src="scripts/jquery.min.js"></script>
	<script src="scripts/jquery.scrollTo.js"></script>
	<script src="scripts/jquery.localScroll.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>


	<script>  Sunlight.highlightAll({lineNumbers:false,  showMenu: true, enableDoclinks :true}); </script>

	<script>
		$( function () {
			$( "#toc" ).toc( {
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : 60
			} );
			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );

		} );
	</script>

	

</body>
</html>
